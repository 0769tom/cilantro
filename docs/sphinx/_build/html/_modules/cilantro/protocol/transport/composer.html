
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cilantro.protocol.transport.composer &#8212; cilantro 9000 BC documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cilantro.protocol.transport.composer</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cilantro</span> <span class="k">import</span> <span class="n">Constants</span>
<span class="kn">from</span> <span class="nn">cilantro.messages</span> <span class="k">import</span> <span class="n">MessageBase</span><span class="p">,</span> <span class="n">ReactorCommand</span><span class="p">,</span> <span class="n">Envelope</span>
<span class="kn">from</span> <span class="nn">cilantro.protocol.reactor.interface</span> <span class="k">import</span> <span class="n">ReactorInterface</span>
<span class="kn">from</span> <span class="nn">cilantro.protocol.reactor.executor</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">cilantro.logger</span> <span class="k">import</span> <span class="n">get_logger</span>
<span class="kn">from</span> <span class="nn">cilantro.protocol.structures</span> <span class="k">import</span> <span class="n">EnvelopeAuth</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The Composer class serves as a high level API for a StateMachine (application layer) to execute networking commands on</span>
<span class="sd">the ReactorDaemon process. It creates</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Composer"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer">[docs]</a><span class="k">class</span> <span class="nc">Composer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface</span><span class="p">:</span> <span class="n">ReactorInterface</span><span class="p">,</span> <span class="n">signing_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Node&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.Composer&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signing_key</span> <span class="o">=</span> <span class="n">signing_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifying_key</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Protocol</span><span class="o">.</span><span class="n">Wallets</span><span class="o">.</span><span class="n">get_vk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signing_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_package_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">MessageBase</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Envelope</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method to package a message into an envelope</span>
<span class="sd">        :param msg: The MessageBase instance to package</span>
<span class="sd">        :return: An Envelope instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Envelope</span><span class="p">,</span> <span class="s2">&quot;Attempted to package a &#39;message&#39; that is already an envelope&quot;</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">MessageBase</span><span class="p">),</span> <span class="s2">&quot;Attempted to package a message that is not a MessageBase subclass&quot;</span>

        <span class="k">return</span> <span class="n">Envelope</span><span class="o">.</span><span class="n">create_from_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">signing_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signing_key</span><span class="p">,</span> <span class="n">verifying_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verifying_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_package_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">:</span> <span class="n">MessageBase</span><span class="p">,</span> <span class="n">req_env</span><span class="p">:</span> <span class="n">Envelope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Envelope</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method to create a reply envelope. The difference between this func and _package_msg, is that</span>
<span class="sd">        in the reply envelope the UUID must be the hash of the original request&#39;s uuid (not some randomly generated int)</span>
<span class="sd">        :param reply: The reply message (an instance of MessageBase)</span>
<span class="sd">        :param req_env: The original request envelope (an instance of Envelope)</span>
<span class="sd">        :return: An Envelope instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating REPLY envelope with msg type </span><span class="si">{}</span><span class="s2"> for request envelope </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">reply</span><span class="p">),</span> <span class="n">req_env</span><span class="p">))</span>
        <span class="n">request_uuid</span> <span class="o">=</span> <span class="n">req_env</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">uuid</span>
        <span class="n">reply_uuid</span> <span class="o">=</span> <span class="n">EnvelopeAuth</span><span class="o">.</span><span class="n">reply_uuid</span><span class="p">(</span><span class="n">request_uuid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Envelope</span><span class="o">.</span><span class="n">create_from_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">reply</span><span class="p">,</span> <span class="n">signing_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signing_key</span><span class="p">,</span>
                                            <span class="n">verifying_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verifying_key</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="n">reply_uuid</span><span class="p">)</span>

<div class="viewcode-block" id="Composer.resume"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resuming ReactorInterface&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">notify_resume</span><span class="p">()</span></div>

<div class="viewcode-block" id="Composer.pause"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pausing ReactorInterface&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">notify_pause</span><span class="p">()</span></div>

<div class="viewcode-block" id="Composer.add_sub"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.add_sub">[docs]</a>    <span class="k">def</span> <span class="nf">add_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects the subscriber socket to listen to &#39;URL&#39; with filter &#39;filter&#39;.</span>
<span class="sd">        :param url: The URL to CONNECT the sub socket to (ex &#39;tcp://17.1.3.4:4200&#39;)</span>
<span class="sd">        :param filter: The filter to subscribe to. Only data published with this filter will be received. Currently,</span>
<span class="sd">        only one filter per CONNECT is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># url = &quot;tcp://{}:{}&quot;.format(ip or vk, Constants.Ports.PubSub)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">PubSub</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">add_sub</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">vk</span><span class="o">=</span><span class="n">vk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.remove_sub"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.remove_sub">[docs]</a>    <span class="k">def</span> <span class="nf">remove_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop subscribing to a URL and filter. Note that all other subscriber connections will drop this filter as well</span>
<span class="sd">        (so if there is another URL you are subscribing to with the same filter, that sub will no longer work). The</span>
<span class="sd">        pattern at this point is to have a single filter for each &#39;node type&#39;, ie witness/delegate/masternode.</span>

<span class="sd">        If you wish to stop subscribing to a URL, but not necessarily a filter, then call this method and pass in an</span>
<span class="sd">        empty string to FILTER. For example, a delegate might want to stop subscribing to a particular witness, but not</span>
<span class="sd">        all witnesses.</span>

<span class="sd">        :param filter: The filter to subscribe to. Only multipart messages with this filter as the first frame will be</span>
<span class="sd">        received</span>
<span class="sd">        :param url: The URL of the router that the created dealer socket should CONNECT to.</span>
<span class="sd">        :param vk: The Node&#39;s VK to connect to. This will be looked up in the overlay network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">PubSub</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">remove_sub</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">vk</span><span class="o">=</span><span class="n">vk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.remove_sub_url"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.remove_sub_url">[docs]</a>    <span class="k">def</span> <span class="nf">remove_sub_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnects the sub URL from url. Unlike the remove_sub API, this does not remove a filter from the</span>
<span class="sd">        socket. It only disconnects from the url.</span>
<span class="sd">        received</span>
<span class="sd">        :param url: The URL of the router that the created dealer socket should CONNECT to.</span>
<span class="sd">        :param vk: The Node&#39;s VK to connect to. This will be looked up in the overlay network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">PubSub</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">remove_sub_url</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.remove_sub_filter"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.remove_sub_filter">[docs]</a>    <span class="k">def</span> <span class="nf">remove_sub_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a filters from the sub socket. Unlike the remove_sub API, this does not disconnect a URL. It only</span>
<span class="sd">        unsubscribes to &#39;filter</span>
<span class="sd">        :param filter: A string to use as the filter frame. This filter will be unsubscribed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">remove_sub_filter</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.send_pub_msg"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.send_pub_msg">[docs]</a>    <span class="k">def</span> <span class="nf">send_pub_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">MessageBase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publish data with filter frame &#39;filter&#39;. An envelope (including a seal and the metadata) will be created from</span>
<span class="sd">        the MessageBase. If you want to send an existing envelope, use send_pub_env</span>
<span class="sd">        :param filter: A string to use as the filter frame</span>
<span class="sd">        :param message: A MessageBase subclass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_pub_env</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">envelope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_package_msg</span><span class="p">(</span><span class="n">message</span><span class="p">))</span></div>

<div class="viewcode-block" id="Composer.send_pub_env"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.send_pub_env">[docs]</a>    <span class="k">def</span> <span class="nf">send_pub_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">envelope</span><span class="p">:</span> <span class="n">Envelope</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publish envelope with filter frame &#39;filter&#39;.</span>
<span class="sd">        :param filter: A string to use as the filter frame</span>
<span class="sd">        :param envelope: An instance of Envelope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">send_pub</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                                        <span class="n">envelope</span><span class="o">=</span><span class="n">envelope</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.add_pub"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.add_pub">[docs]</a>    <span class="k">def</span> <span class="nf">add_pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a publisher socket that BINDS to &#39;url&#39;</span>
<span class="sd">        :param url: The URL to publish under.</span>
<span class="sd">        :param vk: The Node&#39;s VK to connect to. This will be looked up in the overlay network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">PubSub</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">add_pub</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.remove_pub"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.remove_pub">[docs]</a>    <span class="k">def</span> <span class="nf">remove_pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a publisher (duh)</span>
<span class="sd">        :param url: The URL of the router that the created dealer socket should CONNECT to.</span>
<span class="sd">        :param vk: The Node&#39;s VK to connect to. This will be looked up in the overlay network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">PubSub</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">SubPubExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">SubPubExecutor</span><span class="o">.</span><span class="n">remove_pub</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.add_dealer"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.add_dealer">[docs]</a>    <span class="k">def</span> <span class="nf">add_dealer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a dealer socket at url. Dealers are like &#39;async requesters&#39;, and can connect to a single Router socket (1-1)</span>
<span class="sd">        (side note: A router socket, however, can connect to N dealers)</span>
<span class="sd">        &#39;id&#39; socketopt for the dealer socket will be this node&#39;s verifying key</span>
<span class="sd">        :param url: The URL of the router that the created dealer socket should CONNECT to.</span>
<span class="sd">        :param vk: The Node&#39;s VK to connect to. This will be looked up in the overlay network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">RouterDealer</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="n">add_dealer</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verifying_key</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">vk</span><span class="o">=</span><span class="n">vk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.add_router"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.add_router">[docs]</a>    <span class="k">def</span> <span class="nf">add_router</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a router socket at url. Routers are like &#39;async repliers&#39;, and can connect to many Dealer sockets (N-1)</span>
<span class="sd">        :param url: The URL the router socket should BIND to</span>
<span class="sd">        :param vk: The Node&#39;s VK to connect to. This will be looked up in the overlay network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">RouterDealer</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="n">add_router</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.send_request_msg"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.send_request_msg">[docs]</a>    <span class="k">def</span> <span class="nf">send_request_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">MessageBase</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO docstring</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_request_env</span><span class="p">(</span><span class="n">ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span> <span class="n">vk</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">envelope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_package_msg</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.send_request_env"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.send_request_env">[docs]</a>    <span class="k">def</span> <span class="nf">send_request_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">envelope</span><span class="p">:</span> <span class="n">Envelope</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;tcp://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span> <span class="ow">or</span> <span class="n">vk</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">Ports</span><span class="o">.</span><span class="n">RouterDealer</span><span class="p">)</span>
        <span class="n">reply_uuid</span> <span class="o">=</span> <span class="n">EnvelopeAuth</span><span class="o">.</span><span class="n">reply_uuid</span><span class="p">(</span><span class="n">envelope</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                                        <span class="n">envelope</span><span class="o">=</span><span class="n">envelope</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">reply_uuid</span><span class="o">=</span><span class="n">reply_uuid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composer.send_reply"><a class="viewcode-back" href="../../../../cilantro.protocol.transport.html#cilantro.protocol.transport.composer.Composer.send_reply">[docs]</a>    <span class="k">def</span> <span class="nf">send_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">MessageBase</span><span class="p">,</span> <span class="n">request_envelope</span><span class="p">:</span> <span class="n">Envelope</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a reply message (via a Router socket) for the original reqeust in request_envelope (which came from a</span>
<span class="sd">        Dealer socket). Replies envelope are created as a deterministic function of their original request envelope,</span>
<span class="sd">        so that both parties (the sender and receiver) are in agreement on what the reply envelope should look like</span>
<span class="sd">        :param message: A MessageBase instance that denotes the reply data</span>
<span class="sd">        :param request_envelope: An Envelope instance that denotes the envelope of the original request that we are</span>
<span class="sd">        replying to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">requester_id</span> <span class="o">=</span> <span class="n">request_envelope</span><span class="o">.</span><span class="n">seal</span><span class="o">.</span><span class="n">verifying_key</span>
        <span class="n">reply_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_package_reply</span><span class="p">(</span><span class="n">reply</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">req_env</span><span class="o">=</span><span class="n">request_envelope</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">ReactorCommand</span><span class="o">.</span><span class="n">create_cmd</span><span class="p">(</span><span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">DealerRouterExecutor</span><span class="o">.</span><span class="n">reply</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="n">requester_id</span><span class="p">,</span> <span class="n">envelope</span><span class="o">=</span><span class="n">reply_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  <li><a href="../../../cilantro.html">cilantro</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, team@lamden.io.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>